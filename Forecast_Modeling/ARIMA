import pandas as pd

df = pd.read_csv('Personal_Finance_Dataset.csv', encoding = 'utf-8-sig')
df.head(5)
#df.info()

#ë¬¸ìì—´ì„ datetime í˜•ì‹ìœ¼ë¡œ ë³€í™˜
df['Date'] = pd.to_datetime(df['Date'])

#'ì§€ì¶œ'ë§Œ í•„í„°ë§
expense = df[df['Type'] == 'Expense'].copy()

#ì›” ì»¬ëŸ¼ ìƒì„±
expense['month'] = expense['Date'].dt.to_period('M')

monthly_expenses = expense.groupby('month')['Amount'].sum()
print(monthly_expenses)

import matplotlib.pyplot as plt
from statsmodels.tsa.arima.model import ARIMA
from matplotlib import rcParams
#statsmodelsëŠ” ì‹œê³„ì—´ ì˜ˆì¸¡ìš©ìœ¼ë¡œ ë§¤ìš° ì•ˆì •ì ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
#ì˜ˆì‚° ì´ˆê³¼ ì‹œ ì•Œë¦¼, ì´ë©”ì¼ ë°œì†¡ ë“± ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥ 

rcParams['font.family'] = 'AppleGothic'

#ì˜ˆì‹œ ì§€ì¶œ ë°ì´í„° (6ê°œì›”)
data = {
    'month' : ['2024-07', '2024-08', '2024-09', '2024-10','2024-11','2024-12'],
    'expenses' : [27716.08,22933.69,19383.94,22984.21,23565.96,10938.92]
}

df1 = pd.DataFrame(data)
df1['month'] = pd.to_datetime(df1['month'])
df1.set_index('month', inplace = True)

#ARIMA ëª¨ë¸ í•™ìŠµ ë° ì˜ˆì¸¡ 
model = ARIMA(df1['expenses'], order = (1,1,1)) #ê°„ë‹¨í•œ (1,1,1) ëª¨ë¸ ì‚¬ìš©
#order=(p,d,q)ëŠ” ìë™ ì¡°ì •í•˜ë ¤ë©´ pmdarima.auto_arima() ì‚¬ìš© ê°€ëŠ¥
model_fit = model.fit()

#ë‹¤ìŒ ë‹¬ (2025-01) ì˜ˆì¸¡
forecast = model_fit.forecast(steps=1)
next_month_expense = forecast[0]
next_month = pd.to_datetime('2025-01')

#ì˜ˆì‚° ì„¤ì • 
budget = 25000

#ê²°ê³¼ ì¶œë ¥ ë° ê²½ê³ 
print(f"ì˜ˆì¸¡ëœ ë‹¤ìŒ ë‹¬ ì§€ì¶œì•¡ : {int(next_month_expense)}ì›")
if next_month_expense > budget:
    print("ê²½ê³  : ì˜ˆì‚°ì„ ì´ˆê³¼í•  ê²ƒìœ¼ë¡œ ì˜ˆì‚°ë©ë‹ˆë‹¤!")
else:
    print("ì˜ˆì‚° ë²”ìœ„ ë‚´ì—ì„œ ì§€ì¶œë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.")

#ê·¸ë˜í”„ ì‹œê°í™”
plt.figure(figsize=(10,5))
plt.plot(df1.index, df1['expenses'], label = 'ì‹¤ì œ ì§€ì¶œ')
plt.axhline(budget, color='red', linestyle = '--', label='ì˜ˆì‚° í•œë„')
plt.scatter([next_month], [next_month_expense], color = 'green', label = 'ì˜ˆì¸¡ ì§€ì¶œ')

# ğŸ‘‰ ì˜ˆì¸¡ê°’ í…ìŠ¤íŠ¸ ì¶”ê°€
plt.text(next_month, next_month_expense + 10000, f"{int(next_month_expense):,}ì›", 
         ha='center', va='bottom', fontsize=10, color='black')

plt.title('ì›”ë³„ ì§€ì¶œ ë° ì˜ˆì¸¡')
plt.legend()
plt.grid(True)
plt.show()
