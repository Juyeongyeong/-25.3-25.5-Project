### êµìœ¡ ì„œë¹„ìŠ¤
import pandas as pd
import re

data = pd.read_csv('eeee.csv')

keywords = input("ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì „ê¸°, ìë™ì°¨, í’ˆì§ˆ): ")
keywords = [k.strip() for k in re.split('[, ]+', keywords) if k.strip()] 

data_filtered_by_keywords = data[data['ì œëª©'].apply(lambda x: any(keyword in x for keyword in keywords))]
region = input("\nì›í•˜ëŠ” ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸, ê°•ë‚¨êµ¬, ëŒ€ì „): ").strip()
data_filtered_by_region = data[
    data[['ë„, íŠ¹ë³„ì‹œ, ê´‘ì—­ì‹œ', 'ì‹œ, êµ°', 'êµ¬']].apply(lambda row: region in row.values, axis=1)]

final_filtered_data = data_filtered_by_keywords.merge(
    data_filtered_by_region, how='inner')

if not final_filtered_data.empty:
    print("\nğŸ”¹ ìµœì¢… ì¶”ì²œ êµìœ¡ ëª©ë¡ ğŸ”¹")
    print(final_filtered_data[['ë„, íŠ¹ë³„ì‹œ, ê´‘ì—­ì‹œ', 'ì‹œ, êµ°', 'êµ¬', 'ì œëª©', 'êµìœ¡ì—…ì²´', 'ì‹œì‘ì¼ì', 'ì¢…ë£Œì¼ì', 'êµìœ¡ìœ í˜•']])
    
    output_file = "ì¶”ì²œ_êµìœ¡_ëª©ë¡.xlsx"
    final_filtered_data.to_excel(output_file, index=False, engine='openpyxl')
    print(f"\nê²°ê³¼ê°€ '{output_file}' íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
else:
    print("\nì…ë ¥í•œ í‚¤ì›Œë“œì™€ ì§€ì—­ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” êµìœ¡ì´ ì—†ìŠµë‹ˆë‹¤.")

##########################################################################################

### ì¼ìë¦¬ ì„œë¹„ìŠ¤
import pandas as pd
import re

data = pd.read_csv('ddddd.csv')

he_status = input("ê±´ê°• ìƒíƒœë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê±´ê°•/ë¹„ê±´ê°•): ").strip()

if he_status == "ë¹„ê±´ê°•":
    data_filtered = data[data['ê±´ê°•ìƒíƒœ'] == 'ë¹„ê±´ê°•']
    
    selected_he = input("ë¶ˆí¸í•œ ë¶€ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: íŒ”, ë‹¤ë¦¬ í—ˆë¦¬): ")
    selected_he_list = [x.strip() for x in re.split('[, ]+', selected_he) if x.strip()]

    allowed_parts = ['íŒ”', 'ë‹¤ë¦¬', 'í—ˆë¦¬']
    allowed_parts = [part for part in allowed_parts if part not in selected_he_list]
    
    data_filtered = data_filtered[
        (data_filtered['ë¶ˆí¸í•œ ë¶€ìœ„'].isin(allowed_parts)) &
        (data_filtered['ë¶ˆí¸í•œ ë¶€ìœ„'] != '')]
    
    if data_filtered.empty:
        print(f"ì„ íƒí•œ '{', '.join(selected_he_list)}' ë¶€ìœ„ë¥¼ ì œì™¸í•œ ì¼ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.")
        exit()
elif he_status == "ê±´ê°•":
    data_filtered = data
else:
    print("ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.")
    exit()

selected_gender = input("ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš” (ë‚¨ì/ì—¬ì): ").strip()

if selected_gender in ["ë‚¨ì", "ì—¬ì"]:
    data_filtered = data_filtered[(data_filtered['ì„±ë³„'] == selected_gender) | (data_filtered['ì„±ë³„'] == 'ë¬´ê´€')]
else:
    print("ì˜¬ë°”ë¥¸ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”.")
    exit()

try:
    age = int(input("ë‚˜ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”: "))
    data_filtered = data_filtered[(data_filtered['ìµœì†Œë‚˜ì´'] <= age) & (data_filtered['ìµœëŒ€ë‚˜ì´'] >= age)]

    if data_filtered.empty:
        print("ì…ë ¥í•œ ë‚˜ì´ì— í•´ë‹¹í•˜ëŠ” ì¼ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.")
        exit()
except ValueError:
    print("ìœ íš¨í•œ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
    exit()

keywords = input("ê²€ìƒ‰í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ìŒì‹, ì–´ë¦°ì´, ì§€ì—­): ")
keywords = [k.strip() for k in re.split('[, ]+', keywords) if k.strip()] 

data_filtered = data_filtered[data_filtered['ì œëª©'].apply(lambda x: any(keyword in x for keyword in keywords))]

region = input("\nì›í•˜ëŠ” ì§€ì—­ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì„œìš¸, ê°•ë‚¨êµ¬, ëŒ€ì „): ").strip()

data_filtered = data_filtered[
    data_filtered[['íŠ¹ë³„ì‹œë„', 'ì‹œêµ°', 'êµ¬']].apply(
        lambda row: region in row.values, axis=1
    )
]

data_filtered = data_filtered[data_filtered['ì°¸ì—¬ì¸ì›'] < data_filtered['ê³„íšì¸ì›']]

if not data_filtered.empty:
    print("\nğŸ”¹ ìµœì¢… ì¶”ì²œ ì¼ìë¦¬ ëª©ë¡ ğŸ”¹")
    print(data_filtered[['íŠ¹ë³„ì‹œë„', 'ì‹œêµ°', 'êµ¬', 'ì œëª©', 'ì‚¬ì—…ì²´ëª…','êµìœ¡ì—…ì²´', 'ì‚¬ì—…ìœ í˜•', 'ê±´ê°•ìƒíƒœ', 'ë¶ˆí¸í•œ ë¶€ìœ„', 'ì„±ë³„', 'ìµœì†Œë‚˜ì´', 'ìµœëŒ€ë‚˜ì´', 'ì°¸ì—¬ì¸ì›', 'ê³„íšì¸ì›']])
    
    # ì—‘ì…€ íŒŒì¼ë¡œ ì €ì¥
    output_file = "ì¶”ì²œ_ì¼ìë¦¬_ëª©ë¡.xlsx"
    data_filtered.to_excel(output_file, index=False, engine='openpyxl')
    print(f"\nê²°ê³¼ê°€ '{output_file}' íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
else:
    print("\nì…ë ¥í•œ ëª¨ë“  ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ì¼ìë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.")
