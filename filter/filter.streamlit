import streamlit as st
import time
from streamlit_autorefresh import st_autorefresh
import pandas as pd
import re

def go_to(page_name):
    st.session_state.page = page_name
    st.rerun()

# ìƒíƒœ ì´ˆê¸°í™”
if "page" not in st.session_state:
    st.session_state.page = "main"
#streamlit
    st.session_state.start_time = time.time()

# ìë™ ìƒˆë¡œê³ ì¹¨: 1ì´ˆë§ˆë‹¤ ê³„ì† ìƒˆë¡œê³ ì¹¨
if st.session_state.page == "main":
    st_autorefresh(interval=1000, key="auto_refresh")  # limit ì œê±°
    st.title("ì¢‹ì€ ì•„ì¹¨ì…ë‹ˆë‹¤, oooë‹˜!")
    st.write("ì˜¤ëŠ˜ ë‚ ì”¨ëŠ” ë¯¸ì„¸ë¨¼ì§€ê°€ ë§ìœ¼ë‹ˆ ìœ ì˜í•˜ì„¸ìš”!ğŸ¤§")

    elapsed = time.time() - st.session_state.start_time
    #st.write(f"ê²½ê³¼ ì‹œê°„: {elapsed:.2f}ì´ˆ")  # ë””ë²„ê¹…ìš©

    if elapsed >= 7:
        st.session_state.page = "next"
        st.rerun()  # ë˜ëŠ” st.experimental_rerun()

elif st.session_state.page == "next":
    st.title("ğŸ”ì˜¤ëŠ˜ì€ ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì„¸ìš”?")
    if st.button("ğŸ§‘ğŸ¼â€ğŸŒ¾ìš°ë¦¬ ë™ë„¤ ì¼ìë¦¬"):
        go_to("ì¼ìë¦¬")

    elif st.button("ğŸ§‘ğŸ¼â€ğŸ«ìš°ë¦¬ ë™ë„¤ êµìœ¡"):
        go_to("êµìœ¡")

    elif st.button("ğŸ¡ìš°ë¦¬ ë™ë„¤ ì´ì•¼ê¸°"):
        go_to("ì´ì•¼ê¸°")

if st.session_state.page == "ì¼ìë¦¬":
    if st.button("â—€ï¸ëŒì•„ê°€ê¸°"):
        go_to("next")
    st.title("ğŸ‘©â€ğŸŒ¾ìš°ë¦¬ ë™ë„¤ ì¼ìë¦¬")
    st.write("ìš°ë¦¬ ë™ë„¤ ì¼ìë¦¬ / ì¼ìë¦¬ í›„ê¸°")
    name = st.text_input("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”")
    age = st.number_input("ë‚˜ì´", min_value=65, max_value=100)
    #interests = st.multiselect("ê´€ì‹¬ ë¶„ì•¼", ["ê±´ê°•", "ìš”ë¦¬", "ì—¬í–‰", "ì·¨ë¯¸", "ì¼ìë¦¬"])
    st.write(f"ì…ë ¥ëœ ì´ë¦„: {name}, ë‚˜ì´: {age}")

    # ë°ì´í„° ë¡œë”©
    data = pd.read_csv('dddd.csv')
    st.title("ğŸ” í‚¤ì›Œë“œ ê¸°ë°˜ ì¼ìë¦¬ ê²€ìƒ‰")
    # ì‚¬ìš©ì í‚¤ì›Œë“œ ì…ë ¥
    user_input = st.text_input("í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì‹¤ìŠµ, ê´€ë¦¬, ëŒë´„)")
    # ì²´í¬ë°•ìŠ¤ ì…ë ¥
    is_checked = st.checkbox('ì•„í”ˆ ê³³ì´ ìˆì–´ìš”')
    # í•„í„°ë§ëœ ë°ì´í„° ì´ˆê¸°ê°’ ì„¤ì •
    filtered_data = data.copy()
    # í‚¤ì›Œë“œ í•„í„°ë§

    if user_input:
        keywords = [kw.strip() for kw in user_input.split(',') if kw.strip()]
        filtered_data = filtered_data[filtered_data['ì œëª©'].apply(lambda x: any(keyword in x for keyword in keywords))]

    # ê±´ê°•ìƒíƒœ í•„í„°ë§
    if is_checked:
        filtered_data = filtered_data[filtered_data['ê±´ê°•ìƒíƒœ'] == 'ë¹„ê±´ê°•']

        user_input2 = st.text_input("ì–´ë””ê°€ ì•„í”„ì‹ ê°€ìš”? (ì˜ˆ: í—ˆë¦¬, ê±´ê°•, ë‹¤ë¦¬)")
        if user_input2:
            keywords1 = [kw.strip() for kw in user_input1.split(',') if kw.strip()]
            filtered_data = filtered_data[
                filtered_data['ì œëª©'].apply(lambda x: any(keyword1 in x for keyword1 in keywords1))]
        else:
            if filtered_data.empty:
                st.info("")
            else:
                st.dataframe(filtered_data)
    # ìµœì¢… ì¶œë ¥
    st.write("### ğŸ“„ ê²€ìƒ‰ ê²°ê³¼:")
    if filtered_data.empty:
        st.info("â—ê²€ìƒ‰ ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.")
    else:
        st.dataframe(filtered_data)


elif st.session_state.page == "êµìœ¡":
    if st.button("â—€ï¸ëŒì•„ê°€ê¸°"):
        go_to("next")
    st.title("ğŸ§‘ğŸ¼â€ğŸ«ìš°ë¦¬ ë™ë„¤ êµìœ¡")
    st.write("ìš°ë¦¬ ë™ë„¤ êµìœ¡ ì¶”ì²œ / ìˆ˜ê°• í›„ê¸°")

elif st.session_state.page == "ì´ì•¼ê¸°":
    if st.button("â—€ï¸ëŒì•„ê°€ê¸°"):
        go_to("next")
    st.title("ğŸ¡ìš°ë¦¬ ë™ë„¤ ì´ì•¼ê¸°")
    st.write("ìš°ë¦¬ ë™ë„¤ ì¥ì¸/ ìš°ë¦¬ ë™ë„¤ ìƒˆì†Œì‹")

